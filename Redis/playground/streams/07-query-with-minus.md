# Redis Streams 직접 구현하며 배우기

## 📋 Stage 목록

| Stage | 제목 | 난이도 |
|-------|------|--------|
| 1 | TYPE 명령어 구현하기 | ⬤○○ 쉬움 |
| 2 | 스트림 생성하기 | ⬤⬤○ 보통 |
| 3 | 엔트리 ID 유효성 검증 | ⬤○○ 쉬움 |
| 4 | 부분 자동 생성 ID | ⬤⬤○ 보통 |
| 5 | 완전 자동 생성 ID | ⬤⬤○ 보통 |
| 6 | 스트림에서 엔트리 조회하기 | ⬤⬤○ 보통 |
| **7** | **`-` 를 사용한 쿼리** | ⬤○○ 쉬움 |
| 8 | `+` 를 사용한 쿼리 | ⬤○○ 쉬움 |
| 9 | XREAD로 단일 스트림 조회 | ⬤⬤○ 보통 |
| 10 | XREAD로 다중 스트림 조회 | ⬤⬤○ 보통 |
| 11 | 블로킹 읽기 | ⬤⬤⬤ 어려움 |
| 12 | 타임아웃 없는 블로킹 읽기 | ⬤⬤○ 보통 |
| 13 | `$` 를 사용한 블로킹 읽기 | ⬤○○ 쉬움 |

---

## Stage 7: `-` 를 사용한 쿼리

### 🎯 목표

`XRANGE` 명령어에서 **`-`를 최소 ID로 인식**하도록 구현합니다.

---

### 📚 배경 지식

#### 특수 ID: `-`

`-`는 **가능한 가장 작은 ID**를 의미합니다. `XRANGE`의 시작 ID로 사용하면 스트림의 첫 번째 엔트리부터 조회합니다.

```
XRANGE mystream - 3-0
                ↑
          스트림의 처음부터
```

#### 내부적으로 `-`의 의미

`-`는 `0-0`보다도 작은 개념적인 최소값입니다. 실제 구현에서는 `0-0`으로 취급해도 됩니다 (어차피 `0-0`은 데이터로 사용할 수 없으므로).

---

### ✅ 통과 조건

- `XRANGE mystream - <end>` 형식의 쿼리를 처리할 수 있어야 합니다
- 스트림의 첫 번째 엔트리부터 조회되어야 합니다

---

### 💡 힌트

ID 파싱 로직에 특수 케이스를 추가하세요:

```kotlin
fun parseRangeId(id: String): StreamId {
    return when (id) {
        "-" -> StreamId(0, 0)  // 최소 ID
        // "+"는 Stage 8에서 추가
        else -> StreamId.parse(id)
    }
}

fun handleXRange(args: List<String>): String {
    val key = args[0]
    val startId = parseRangeId(args[1])  // "-" 처리
    val endId = parseRangeId(args[2])
    
    // 나머지 로직은 동일...
}
```

---

### 🧪 테스트 방법

```bash
redis-cli

# 테스트 데이터 추가
127.0.0.1:6379> XADD mystream 1-0 a 1
"1-0"
127.0.0.1:6379> XADD mystream 2-0 b 2
"2-0"
127.0.0.1:6379> XADD mystream 3-0 c 3
"3-0"

# "-"로 처음부터 조회
127.0.0.1:6379> XRANGE mystream - 2-0
1) 1) "1-0"
   2) 1) "a"
      2) "1"
2) 1) "2-0"
   2) 1) "b"
      2) "2"

# "-"로 전체 조회 (끝 ID를 크게 지정)
127.0.0.1:6379> XRANGE mystream - 999999999999-0
1) 1) "1-0"
   2) 1) "a"
      2) "1"
2) 1) "2-0"
   2) 1) "b"
      2) "2"
3) 1) "3-0"
   2) 1) "c"
      2) "3"
```

---

### 🤔 생각해볼 점

왜 `-`라는 특수 문자를 사용할까요?

- **편의성**: 첫 번째 엔트리의 ID를 모르더라도 조회 가능
- **일관성**: 어떤 스트림이든 `-`로 처음부터 조회 가능
- **가독성**: `0-0`보다 `-`가 "처음부터"라는 의미를 더 명확하게 전달

---

### ➡️ 다음 단계

Stage 8에서는 **`+` 특수 ID로 스트림의 끝까지 조회**하는 기능을 구현합니다.

# Redis μ§μ ‘ κµ¬ν„ν•λ©° λ°°μ°κΈ°

## π“‹ Stage λ©λ΅

| Stage | μ λ© | λ‚μ΄λ„ |
|-------|------|--------|
| 1 | ν¬νΈμ— λ°”μΈλ”©ν•κΈ° | β¬¤β—‹β—‹ λ§¤μ° μ‰¬μ›€ |
| 2 | PINGμ— μ‘λ‹µν•κΈ° | β¬¤β—‹β—‹ μ‰¬μ›€ |
| **3** | **μ—¬λ¬ PINGμ— μ‘λ‹µν•κΈ°** | β¬¤β—‹β—‹ μ‰¬μ›€ |
| 4 | λ™μ‹ ν΄λΌμ΄μ–ΈνΈ μ²λ¦¬ν•κΈ° | β¬¤β¬¤β—‹ λ³΄ν†µ |
| 5 | ECHO λ…λ Ήμ–΄ κµ¬ν„ν•κΈ° | β¬¤β¬¤β—‹ λ³΄ν†µ |
| 6 | SET & GET λ…λ Ήμ–΄ κµ¬ν„ν•κΈ° | β¬¤β¬¤β—‹ λ³΄ν†µ |
| 7 | ν‚¤ λ§λ£(Expiry) κµ¬ν„ν•κΈ° | β¬¤β¬¤β—‹ λ³΄ν†µ |

---

## Stage 3: μ—¬λ¬ PINGμ— μ‘λ‹µν•κΈ°

### π― λ©ν‘

μ΄μ „ λ‹¨κ³„μ—μ„λ” ν•λ‚μ `PING`μ— μ‘λ‹µν•κ³  μ—°κ²°μ„ μΆ…λ£ν–μµλ‹λ‹¤. μ΄λ²μ—λ” **ν•λ‚μ μ—°κ²°μ—μ„ μ—¬λ¬ λ…λ Ήμ–΄λ¥Ό μ—°μ†μΌλ΅ μ²λ¦¬**ν•  μ μλ„λ΅ κ°μ„ ν•©λ‹λ‹¤.

---

### π“ λ°°κ²½ μ§€μ‹

#### μ§€μ†μ  μ—°κ²° (Persistent Connection)

μ‹¤μ  Redisλ” ν΄λΌμ΄μ–ΈνΈμ™€ **μ§€μ†μ μΈ μ—°κ²°**μ„ μ μ§€ν•©λ‹λ‹¤. ν•λ‚μ TCP μ—°κ²°μ—μ„ μμ² κ°μ λ…λ Ήμ–΄λ¥Ό μ²λ¦¬ν•  μ μμ£ . μ΄λ ‡κ² ν•λ©΄:

- λ§¤λ² TCP ν•Έλ“μ…°μ΄ν¬λ¥Ό ν•μ§€ μ•μ•„ **μ§€μ—° μ‹κ°„ κ°μ†**
- μ—°κ²° μƒμ„±/μΆ…λ£ μ¤λ²„ν—¤λ“κ°€ μ—†μ–΄ **μ²λ¦¬λ‰ μ¦κ°€**

#### μ΄λ²¤νΈ λ£¨ν”„

μ§€μ†μ  μ—°κ²°μ„ μ²λ¦¬ν•λ ¤λ©΄ **μ΄λ²¤νΈ λ£¨ν”„** ν¨ν„΄μ΄ ν•„μ”ν•©λ‹λ‹¤:

```
while (μ—°κ²°μ΄ μ μ§€λλ” λ™μ•) {
    λ…λ Ήμ–΄ = μ½κΈ°()
    κ²°κ³Ό = μ²λ¦¬(λ…λ Ήμ–΄)
    μ‘λ‹µ(κ²°κ³Ό)
}
```

---

### β… ν†µκ³Ό μ΅°κ±΄

- ν•λ‚μ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ—μ„ μ—¬λ¬ `PING` λ…λ Ήμ–΄λ¥Ό μ—°μ†μΌλ΅ μ²λ¦¬ν•΄μ•Ό ν•©λ‹λ‹¤
- κ° `PING`λ§λ‹¤ `+PONG\r\n`μΌλ΅ μ‘λ‹µν•΄μ•Ό ν•©λ‹λ‹¤
- ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ„ λ•κΉμ§€ μ„λ²„λ” κ³„μ† λ…λ Ήμ–΄λ¥Ό μ²λ¦¬ν•΄μ•Ό ν•©λ‹λ‹¤

---

### π’΅ ννΈ

`while` λ£¨ν”„λ¥Ό μ‚¬μ©ν•΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ„ λ•κΉμ§€ λ…λ Ήμ–΄λ¥Ό κ³„μ† μ½κ³  μ‘λ‹µν•©λ‹λ‹¤.

```kotlin
import java.net.ServerSocket

fun main() {
    val serverSocket = ServerSocket(6379)
    serverSocket.reuseAddress = true
    
    val clientSocket = serverSocket.accept()
    val reader = clientSocket.getInputStream().bufferedReader()
    val writer = clientSocket.getOutputStream().bufferedWriter()
    
    while (true) {
        val line = reader.readLine() ?: break  // μ—°κ²° μΆ…λ£ μ‹ null λ°ν™
        
        // TODO: RESP ν”„λ΅ν† μ½ νμ‹±
        // TODO: PING λ…λ Ήμ–΄ κ°μ§€ μ‹ +PONG\r\n μ‘λ‹µ
        
        writer.flush()
    }
    
    clientSocket.close()
}
```

**μ£Όμμ‚¬ν•­:**
- `readLine()`μ΄ `null`μ„ λ°ν™ν•λ©΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ€ κ²ƒμ…λ‹λ‹¤
- κ° μ‘λ‹µ ν›„ `flush()`λ¥Ό νΈμ¶ν•΄μ•Ό λ²„νΌκ°€ μ¦‰μ‹ μ „μ†΅λ©λ‹λ‹¤

---

### π§ ν…μ¤νΈ λ°©λ²•

```bash
# redis-cliλ΅ μ—¬λ¬ PING ν…μ¤νΈ
# μ£Όμμ‚¬ν•­ redis-cli μ‹¤ν–‰μ‹ λ°”λ΅ "COMMAND DOCS" λ…λ Ήμ–΄ μ‹¤ν–‰ν›„ "+OK" μ‘λ‹µμ΄ λ„μ–΄μ™€μ•Ό redis-cliμ™€ μ—°κ²°μ΄ μλ¦½λ¨
redis-cli
127.0.0.1:6379> PING
PONG
127.0.0.1:6379> PING
PONG
127.0.0.1:6379> PING
PONG

# λλ” netcatμΌλ΅ μ—°μ† λ…λ Ήμ–΄ μ „μ†΅
(echo -e "*1\r\n\$4\r\nPING\r\n"; echo -e "*1\r\n\$4\r\nPING\r\n"; sleep 1) | nc localhost 6379
# μμƒ μ¶λ ¥:
# +PONG
# +PONG
```

---

### π¤” μƒκ°ν•΄λ³Ό μ 

ν„μ¬ κµ¬ν„μ—μ„λ” ν• λ²μ— **ν•λ‚μ ν΄λΌμ΄μ–ΈνΈλ§** μ²λ¦¬ν•  μ μμµλ‹λ‹¤. μ²« λ²μ§Έ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ μ μ§€ν•λ” λ™μ• λ‘ λ²μ§Έ ν΄λΌμ΄μ–ΈνΈλ” λ€κΈ°ν•΄μ•Ό ν•©λ‹λ‹¤. λ‹¤μ λ‹¨κ³„μ—μ„ μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•©λ‹λ‹¤.

---

### β΅οΈ λ‹¤μ λ‹¨κ³„

Stage 4μ—μ„λ” **μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈλ¥Ό λ™μ‹μ— μ²λ¦¬**ν•λ” κΈ°λ¥μ„ κµ¬ν„ν•©λ‹λ‹¤.
